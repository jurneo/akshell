<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Train your own data | </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Train your own data using TensorFlow Object DetectionThis article provides a summary of what has been gone through to implement blob-detection with TensorFlow object detection deep learning model. The">
<meta name="keywords" content="tensorflow">
<meta property="og:type" content="article">
<meta property="og:title" content="Train your own data">
<meta property="og:url" content="http://jurneo.github.io/2018/01/19/Train-your-own-data/index.html">
<meta property="og:site_name">
<meta property="og:description" content="Train your own data using TensorFlow Object DetectionThis article provides a summary of what has been gone through to implement blob-detection with TensorFlow object detection deep learning model. The">
<meta property="og:image" content="http://jurneo.github.io/2018/01/19/Train-your-own-data/images/01.png">
<meta property="og:image" content="http://jurneo.github.io/2018/01/19/Train-your-own-data/images/02.png">
<meta property="og:image" content="http://jurneo.github.io/2018/01/19/Train-your-own-data/images/03.png">
<meta property="og:updated_time" content="2018-01-25T04:37:32.543Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Train your own data">
<meta name="twitter:description" content="Train your own data using TensorFlow Object DetectionThis article provides a summary of what has been gone through to implement blob-detection with TensorFlow object detection deep learning model. The">
<meta name="twitter:image" content="http://jurneo.github.io/2018/01/19/Train-your-own-data/images/01.png">
  
    <link rel="alternate" href="/atom.xml" title="" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/akshell/index.html">Home</a></li>
        
          <li><a class=""
                 href="/akshell/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title"></h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-Train-your-own-data" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      Train your own data
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2018/01/19/Train-your-own-data/" class="article-date"><time datetime="2018-01-19T08:22:05.317Z" itemprop="datePublished">2018-01-19</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Train-your-own-data-using-TensorFlow-Object-Detection"><a href="#Train-your-own-data-using-TensorFlow-Object-Detection" class="headerlink" title="Train your own data using TensorFlow Object Detection"></a><strong>Train your own data using TensorFlow Object Detection</strong></h3><p>This article provides a summary of what has been gone through to implement blob-detection with TensorFlow object detection deep learning model. The main repository is based on <a href="https://github.com/tensorflow/models" target="_blank" rel="noopener">TensorFlow repo</a></p>
<p>The general guideline is officially described <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/using_your_own_dataset.md" target="_blank" rel="noopener">here</a> in the original github repo, and with some pointer from this <a href="https://towardsdatascience.com/how-to-train-your-own-object-detector-with-tensorflows-object-detector-api-bec72ecfe1d9" target="_blank" rel="noopener">site</a> .</p>
<h4 id="1-Setup-environment"><a href="#1-Setup-environment" class="headerlink" title="1. Setup environment"></a><strong>1. Setup environment</strong></h4><p>using command line, we need to point the TF Slim module as required by TF scripts later, by typing the following commands:</p>
<pre><code>D:\&gt;set PYTHONPATH=D:\workspace\projects\models\research\slim
</code></pre><h4 id="2-Create-Structured-Folders"><a href="#2-Create-Structured-Folders" class="headerlink" title="2. Create Structured Folders"></a><strong>2. Create Structured Folders</strong></h4><p>Say our dataset is placed in the folder named: 180103, three folders are needed to be created inside this folder:</p>
<ul>
<li>annotations</li>
<li>data</li>
<li>images</li>
</ul>
<a id="more"></a>
<p>With the content as followings, the images folder:</p>
<p><img src="./images/01.png" alt="The images folder"></p>
<p>The annotation folder</p>
<p><img src="./images/02.png" alt="The annotations"></p>
<p>The data folder</p>
<p><img src="./images/03.png" alt="The data"></p>
<p>The example content of blob1_0002.xml is:</p>
<pre><code>&lt;annotation verified=&quot;yes&quot;&gt;
    &lt;folder&gt;images&lt;/folder&gt;
    &lt;filename&gt;blob1_0002.png&lt;/filename&gt;
    &lt;path&gt;C:\Users\k\Desktop\dataset\180103\images\blob1_0002.png&lt;/path&gt;
    &lt;source&gt;
        &lt;database&gt;Unknown&lt;/database&gt;
    &lt;/source&gt;
    &lt;size&gt;
        &lt;width&gt;400&lt;/width&gt;
        &lt;height&gt;300&lt;/height&gt;
        &lt;depth&gt;1&lt;/depth&gt;
    &lt;/size&gt;
    &lt;segmented&gt;0&lt;/segmented&gt;
    &lt;object&gt;
        &lt;name&gt;blob1&lt;/name&gt;
        &lt;pose&gt;Unspecified&lt;/pose&gt;
        &lt;truncated&gt;0&lt;/truncated&gt;
        &lt;difficult&gt;0&lt;/difficult&gt;
        &lt;bndbox&gt;
            &lt;xmin&gt;246&lt;/xmin&gt;
            &lt;ymin&gt;15&lt;/ymin&gt;
            &lt;xmax&gt;297&lt;/xmax&gt;
            &lt;ymax&gt;67&lt;/ymax&gt;
        &lt;/bndbox&gt;
    &lt;/object&gt;
&lt;/annotation&gt;
</code></pre><p>with the key tags as: <strong>path</strong>, <strong>filename</strong>, <strong>size</strong>, and <strong>bndbox</strong>.</p>
<h4 id="3-Convert-XML-to-CSV-files"><a href="#3-Convert-XML-to-CSV-files" class="headerlink" title="3. Convert XML to CSV files"></a><strong>3. Convert XML to CSV files</strong></h4><p>We need to generate list of file names, containing object name and its bounding box in CSV format.</p>
<p>The code snippet below allows to do that:</p>
<pre><code>import os
import glob
import pandas as pd
import xml.etree.ElementTree as ET

def xml_to_csv(path):
    xml_list = []
    for xml_file in glob.glob(path + &apos;/*.xml&apos;):
        tree = ET.parse(xml_file)
        root = tree.getroot()
        for member in root.findall(&apos;object&apos;):
            value = (root.find(&apos;filename&apos;).text,
                    int(root.find(&apos;size&apos;)[0].text),
                    int(root.find(&apos;size&apos;)[1].text),
                    member[0].text,
                    int(member[4][0].text),
                    int(member[4][1].text),
                    int(member[4][2].text),
                    int(member[4][3].text)
                    )
            xml_list.append(value)
    column_name = [&apos;filename&apos;, &apos;width&apos;, &apos;height&apos;, &apos;class&apos;, &apos;xmin&apos;, &apos;ymin&apos;, &apos;xmax&apos;, &apos;ymax&apos;]
    xml_df = pd.DataFrame(xml_list, columns=column_name)
    return xml_df


def main():
    image_path = os.path.join(os.getcwd(), &apos;annotations&apos;)
    xml_df = xml_to_csv(image_path)
    xml_df.to_csv(&apos;blob1_labels.csv&apos;, index=None)
    print(&apos;Successfully converted xml to csv.&apos;)
</code></pre><p>And below snippet code is to split the test and train label:</p>
<pre><code>h1 = &apos;filename,width,height,class,xmin,ymin,xmax,ymax&apos;
f1 = open(&apos;./180103/data/blob1_labels.csv&apos;)
s = f1.readlines()[1:]
shuffle(s)

print(len(s[0:40]))
print(len(s[40:]))

f2 = open(&apos;./180103/data/test_labels.csv&apos;, mode=&apos;w&apos;)
f2.write(h1)
for s1 in s[0:40]:
    f2.write(s1)

f3 = open(&apos;./180103/data/train_labels.csv&apos;, mode=&apos;w&apos;)
f3.write(h1)
for s1 in s[40:]:
    f3.write(s1)
</code></pre><p>For generating TFRecord dataset, we need to modify the original example script as mentioned in the official documentation as followings:</p>
<pre><code>def main(_):
    writer = tf.python_io.TFRecordWriter(FLAGS.output_path)
    path = os.path.join(os.getcwd(), &apos;images&apos;)
    examples = pd.read_csv(FLAGS.csv_input)
    grouped = split(examples, &apos;filename&apos;)
    for group in grouped:
        tf_example = create_tf_example(group, path)
        writer.write(tf_example.SerializeToString())
</code></pre><h4 id="4-Update-the-configuration-file"><a href="#4-Update-the-configuration-file" class="headerlink" title="4. Update the configuration file"></a><strong>4. Update the configuration file</strong></h4><p>Create a training folder in the same level with the three folders mentioned earlier. Inside the folder, place the config file based on the detection model to be used. And also the object-detection label file <em>object-detection.pbtxt</em>.</p>
<p>The content of the object-detection.pbtxt is:</p>
<pre><code>item {
id: 1
name: &apos;blob1&apos;
}
</code></pre><p>In this case, we use <em>ssd_mobilenet_v1_pets</em> copied from <code>models\research\object_detection\samples\configs</code></p>
<p> Some parameters to be changed in the config are, first <em>num_classes</em> - to be changed according to our object classes, in this case one. The other parameters are the location of the train and the test record files.</p>
<pre><code>train_input_reader: {
tf_record_input_reader {
    input_path: &quot;./data/train.record&quot;
}
label_map_path: &quot;./training/object-detection.pbtxt&quot;
}
</code></pre><p>and </p>
<pre><code>eval_input_reader: {
tf_record_input_reader {
    input_path: &quot;./data/test.record&quot;
}
label_map_path: &quot;./training/object-detection.pbtxt&quot;
shuffle: false
num_readers: 1
}
</code></pre><h4 id="5-Train-the-dataset"><a href="#5-Train-the-dataset" class="headerlink" title="5. Train the dataset"></a><strong>5. Train the dataset</strong></h4><p>We are ready to train the dataset by running the following command from the command console.</p>
<pre><code>python train.py --logtostderr --train_dir=training/ --pipeline_config_path=training/ssd_mobilenet_v1_pets.config
</code></pre><p>The code <em>train.py</em> is available from object_detection folder.</p>
<p>Below is the result of training used for simple blob detection</p>
<p><html> </html></p>
<p><body> </body></p>
<p><video width="720" controls><br>  <source src="./images/v0.mp4" type="video/mp4"><br>  Your browser does not support HTML5 video.<br></video></p>
<p></p><p> and for the zooming case .. </p><p></p>
<p><video width="720" controls><br>  <source src="./images/v1.mp4" type="video/mp4"><br>  Your browser does not support HTML5 video.<br></video><br><br><br>.</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://jurneo.github.io/akshell/2018/01/19/Train-your-own-data/" data-id="cjcswbfg50000kswenufttfkz" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tensorflow/">tensorflow</a></li></ul>


    </footer>
  </div>
  
    

  
</article>




        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p>Summary of works and thoughts on my PhD research</p>

</div>


  


  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/tensorflow/">tensorflow</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/tensorflow/" style="font-size: 10px;">tensorflow</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/01/">January 2018</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2018/01/19/Train-your-own-data/">Train your own data</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
